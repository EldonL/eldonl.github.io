<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Android Game - Eldon Lin Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/blogproject.css">
    <script src="js/app.js" defer></script>
    <script src="js/component/header.js" defer></script>
    <script src="js/component/footer.js" defer></script>
    <script src="js/component/logo.js" defer></script>
    <script src="js/component/blogintro.js" defer></script>
    <script src="js/component/blogcontent.js" defer></script>
    <script src="js/component/blogrecent.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>
<body>

    <section class="bg-js-controlled">
        <header-component></header-component>
    </section>
    
    <section class="bg-js-controlled">
        <section class="intro">
            <blogintro-component>
                <span slot ="title">First Android Game - Part 22 - Firebase</span>
                <span slot="date">Dec 03, 2023</span>
                <!-- <button slot="vlogbutton" onclick="OnLinkClick('https://youtu.be/fHY3aUUX3r4')">Watch on youtube</span>    -->
            </blogintro-component>
        </section>
    
    
            <section class="diarypost">
                <blogcontent-component>
                    <span slot ="action1text">This is part 22 of making my first Android Game. If you missed part21, you can find it <a href="blogfirstandroidgame21.html">here</a>. Remember that my goal is to store user data. As mentioned in another blog "There are weapons that the user can buy. If the user starts the game over and come back into the game, it would be great if what they bought are carried over. It can be frustrating for the user if all the weapons are gone. We will be exploring different ways to save data.So now I'm exploring firebase</span>
                    <span slot ="action2text">NOTE: I am using firebase SDK v 11.6.0. Firebase is an app development platform that can help with a backend infrastructure such as authentication. Helps with releases and monitoring such as crashlytics and performance monitoring. While exploring how to save data such as using <a href="blogfirstandroidgame20.html">MAMP</a> and <a href="blogfirstandroidgame21.html">playerprefs</a>, firebase has come across my radar as another option. I visited the <a href="https://firebase.google.com/">firebase website </a>and clicked "Get Started". I created a project called tomato-vs-potato</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase0.PNG" slot="action2image">
                    <span slot ="action3text">I am using the Spark Plan instead of Blaze- which is pay as you go. Spark Plan has usage quotas for database, firestore, storage, phone auth, hosting and Test Lab as well as analytics, notifications, crash reporting etc. It does not have the ability to extend the project with google cloud.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase1.PNG" slot="action3image">
                    <span slot ="action4text">I added an app to get started. First step is to enter my bundle identifier (apple) and package name (google play). </span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase2.PNG" slot="action4image">
                    <span slot ="action5text">Next is to download the config files</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase3.PNG" slot="action5image">
                    <span slot ="action6text">Then import the Firebase Unity SDK. The current version is 11.6.0. As of now I'm not sure what other <a href="https://firebase.google.com/docs/unity/setup?hl=en&authuser=0&_gl=1*7f7t6p*_ga*MzQ1MDkxMzg2LjE3MDE2NDE1NTc.*_ga_CW55HF8NVT*MTcwMTY2MDE4NC4zLjEuMTcwMTY2MDYxNS4xOS4wLjA.#available-libraries">firebase products</a> to import yet</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase4.PNG" slot="action6image">
                    <span slot ="action7text">That's all the steps to add an app. <a href="https://firebase.google.com/docs/guides?hl=en&authuser=0&_gl=1*14sp6r1*_ga*MzQ1MDkxMzg2LjE3MDE2NDE1NTc.*_ga_CW55HF8NVT*MTcwMTY2MDE4NC4zLjEuMTcwMTY2MDY0NS42MC4wLjA.">Firebase documentation</a> can be found here. <a href="https://firebase.google.com/docs/samples?hl=en&authuser=0&_gl=1*jqvxob*_ga*MzQ1MDkxMzg2LjE3MDE2NDE1NTc.*_ga_CW55HF8NVT*MTcwMTY2MDE4NC4zLjEuMTcwMTY2MDY1MC41NS4wLjA.">Sample Firebase apps</a> can be found here</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase5.PNG" slot="action7image">
                    <span slot ="action8text">I can place the google service files anywhere in the assets folder. Therefore, I placed in Assets/Plugins/Firebase folder</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase6.PNG" slot="action8image">
                    <span slot ="action9text">I unzip the firebase unity sdk and unzipped and saw many unity packages including FirebaseAuth, FirebaseFireStore, FirebaseFunctions etc. I may need to use these eventually. However, for now I only need FirebaseAnalytics</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase7.PNG" slot="action9image">
                    <span slot ="action10text">When importing FirebaseAnalytics, I noted down that the ExternalDependencyManager is version 1.2.177. This is the one that's compatible with the firebaseAnalytics I'm using </span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase8.PNG" slot="action10image">
                    <span slot ="action11text">Also noticed that firebase analytics has dependencies on firebase app version 11.6.0</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase9.PNG" slot="action11image">
                    <span slot ="action12text">After importing, some errors appeared. One related to XCode -which may be due to the platform I'm on since I'm using windows. A popup window appeared as well, I clicked Enable</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase10.PNG" slot="action12image">
                    <span slot ="action13text">After I click enable, another window appeared. I am waiting for it to load...for a long time. I closed it and tried pressing play and exit play mode. The errors and the same window will reappear.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase11.PNG" slot="action13image">
                    <span slot ="action14text">I tried pushing to github, but file size too big. To resolve this I added "*.bundle filter=lfs diff=lfs merge=lfs -text" in .gitattributes. This is for lfs files. </span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase12.PNG" slot="action14image">
                    <span slot ="action15text">I tried making a build just to see if a build can be made. It has been building for over 2 hours. So I cancelled it (forced closed cause cancelled was taking hours as well). Discarded my changes. Made a new branch. Created a new firebase project but this time only for Android. I still get Resolver issues and long building times. Turns out it was because my file path (the parent folder!!!) had a space in it. After removing the space > reopend the project > Android Resolver finished and I can make a build that finished in under 10 minutes.</span>
                    <span slot ="action16text">I want to try to log some events. I followed this <a href="https://firebase.google.com/docs/unity/setup#prerequisites">documentation</a> and this <a href="https://www.youtube.com/watch?v=y2GQx--69q8">Youtube Video</a> to initialize firebase. Then followed this <a href="https://firebase.google.com/docs/analytics/unity/events">documentation</a> to log events. The initialization appears to only occur once as the Debug.Log only printed the first time I tested in the editor.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase13.PNG" slot="action16image">
                    <span slot ="action17text">I checked Firebase analytics, but nothing appeared. Sometimes it can take up to 24 hours when you first create an event. However, I think I didn't initialize firebase properly or setup connecting Unity to firebase correctly. I may need to follow this Youtube video <a href="https://www.youtube.com/watch?v=KxrgFHXDhfg&t=832s">Unity | Getting started with Firebase Analytics with Unity | Game development (2023)</a></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase14.PNG" slot="action17image">
                    <span slot ="action18text">I then noticed in the analytics dashboard, a 0.0.9.0 version appeared.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase15.PNG" slot="action18image">
                    <span slot ="action19text">When I clicked on that it tells me that as of 8:36pm there was one user who used it for 37 seconds. So SOMETHING IS SENDING!!</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase16.PNG" slot="action19image">
                    <span slot ="action20text">At first I wasn't sure if it was sending from an android build or my editor. However, according to this <a href="https://www.youtube.com/watch?v=JDxXiarsrHk&list=PLl-K7zZEsYLnw0-bXz2f9zo6745VQ_2ep">Official Firebase Analytics Youtube tutorial</a> It says that analytics only works on the phone and not the editor! I then checked Realtime Analytics and I can see some default events that Firebase already tracks. So that means analytics is connected! Probably my own events will take longer - video says up to 1 hours to upload and 24 hours to process.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase17.PNG" slot="action20image">
                    <span slot ="action21text">After 24 hours I still did not see my events</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase18.PNG" slot="action21image">
                    <span slot ="action22text">I decided to follow the official firebase youtube tutorial mentioned earlier. In FirebaseAnalyticsLearning.cs, I changed the code and commented out the LogEvents</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase19.PNG" slot="action22image">
                    <span slot ="action23text">Then a LevelLogginBehaviour.cs was created. At the <code>Start()</code>, a <code>LevelStart event will be logged</code> and <code>OnDestroy()</code> a <code>LevelEnd will be logged</code></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase20.PNG" slot="action23image">
                    <span slot ="action24text">To change scenes when clicking a button. A OnChangeLevelClick.cs is created. I learned that we can use the interface <code>UnityEngine.EventSystems.IPointerClickHandler</code> to click buttons. There is a <code>OnPointerClick</code>.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase21.PNG" slot="action24image">
                    <span slot ="action25text">In FirebaseMainMenu scene. ChangeLevelCllick.cs is attached to the button "MainMenu". Nothing needs to be the on the OnClick in the inspector. Simply attach the script, fill in the scene name and when you press the button, scene will change (assuming you added the scenes in build settings)</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase22.PNG" slot="action25image">
                    <span slot ="action26text">In FirebaseLevel1 Scene, the LevelLoginBehaviour is attached so that everytime we enter and exit FirebaseLevel1 scene, the event will be logged.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase23.PNG" slot="action26image">
                    <span slot ="action27text">NOTE THIS PART IS FOR ANDROID ONLY: Then I make a build, sideload. I want to see my log events in Firebase DebugView. To do that, I needed to do somethings in the command line. First we need to set the events from the device to firebase. Events are cached and sent to firebase in batches. With this property set, we send it automatically <code> adb shell setprop debug.firebase.analytics.app insert-your-package-name</code>. Secondly, to actually print analytics information to the terminal <code>adb shell setprop log.tag.FA VERBOSE</code>. And then thirdly <code>adb shell setprop log.tag.FA-SVC VERBOSE</code>. Fourth, now launch the app. Then you need to contract FA and FA-SVC tag.  <code>adb logcat -s "FA","FA-SVC"</code>. Lastly, when you are done debugging <code>adb shell setprop debug.firebase.analytics.app .none</code> In Firebase DebugView, I will see the events! So at least I know events are working. Now to wait 24 hours. Stay tuned...</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase24.PNG" slot="action27image">
                    <span slot ="action28text">I checked after 12 hours. The LevelStart and LevelEnd event exists!!</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase25.PNG" slot="action28image">
                    <span slot ="action29text">I can get analytics but remember our goal is to store user data like weapons. So next let's figure out how to store user login using Firebase Authentication. I'll try to follow this <a href="https://firebase.google.com/docs/auth/unity/custom-auth?authuser=0">link</a>. First I went into my project on firebase > project settings > Service Accounts > Generate new private key. A warning pops up saying <p style="color:red;">"Your private key gives access to your project's Firebase services. Keep it confidential and never store it in a public repository.Store this file securely, because your new key can't be recovered if lost."</p> However, after I did that and reread the title of the documentation, it says it is for Custom server. The instructions says to copy this file to your authentication server. I don't have a custom server. I want to use firebase own server!</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase26.PNG" slot="action29image">
                    <span slot ="action30text">Instead, I should be following this <a href="https://firebase.google.com/docs/auth/unity/start?authuser=0">Get started link</a>. I'll need to import the FirebaseAuth.Unitypackage from this <a href="https://firebase.google.com/download/unity?authuser=0">Firebase Unity SDK. This link will automatically download sdk</a></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase27.PNG" slot="action30image">
                    <span slot ="action31text">In firebase, I went to my project > Authentication > Sign in method > Email/Password</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/Firebase28.PNG" slot="action31image">
                    <span slot ="action32text">Enable Email/Password</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase29.PNG" slot="action32image">
                    <span slot ="action33text">Back into Unity. I created a script called FirebaseLogin. Instead of creating a login UI. I'm hardcoding the email which I retrieved from this <a href="https://temp-mail.org/en/">temp email website</a> and the password. Pressing L will run the code</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase30.PNG" slot="action33image">
                    <span slot ="action34text">In firebase Authentication, I can see the email login information!</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase31.PNG" slot="action34image">
                    <span slot ="action35text">If I press L again, it will recognize that this user already exist.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase32.PNG" slot="action35image">
                    <span slot ="action36text">Now the user registers, can the user login? Continuing following the get started link. I added this piece of code, if user presses "S", the user should be logged in</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase33.PNG" slot="action36image">
                    <span slot ="action37text">If I passed in the wrong email or password, I would get an error</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase34.PNG" slot="action37image">
                    <span slot ="action38text">If I pass in the correct information then there will be a debug log that the user signed in successfully</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase35.PNG" slot="action38image">
                    <span slot ="action39text">On firebase I can see the Sign in date has changed</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase36.PNG" slot="action39image">
                    <span slot ="action40text">So it's great I can sign users in. There are also other ways to manage users like sign out, delete users, update password, send verification email etc. However, how do I store information in a database? There is firestore database - Cloud firestore. I want to see if I can use this to my advantage to store things like what weapons users has bought. Storing data in Cloud firestore can do things like allowing users to access their information across devices or share progress with other players. I will follow this <a href="https://firebase.google.com/docs/firestore/quickstart">Get Started for Cloud Firestore</a></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase37.PNG" slot="action40image">
                    <span slot ="action41text">I clicked create database button. First the prompt asked me to select a location. There is a warning "After you set this location, you cannot change it later. Also, this location setting will be the location for your default Cloud Storage bucket. "</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase38.PNG" slot="action41image">
                    <span slot ="action42text">The secure rules I select is "start in test mode", because I am not familiar with cloud firestore yet. The warning says "The default security rules for test mode allow anyone with your database reference to view, edit and delete all data in your database for the next 30 days ".</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase39.PNG" slot="action42image">
                    <span slot ="action43text">I am then provided with this page</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase40.PNG" slot="action43image">
                    <span slot ="action44text">There is instructions regarding "You must minify the build to avoid the message Error while merging dex archives". I'm curious to see when this error will appear so I'm not going to look into how to configure this yet until this error appears</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/firebase41.PNG" slot="action44image">
                </blogcontent-component>
            </section>

            <section class="blogrecent">
                <blogrecent-component>
                    <span slot="recentblogs">Recent blogs</span>
                    <span slot="seeallblogs"><a href="index.html#blog">See all blogs</a></span>
                </blogrecent-component>

            </section>
    </section>
    

 


    <section class="footer-section bg-js-controlled" id="contact">
        <footer-component></footer-component>
    </section>


    
    
</body>
</html>

