<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Android Game - Eldon Lin Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/blogproject.css">
    <script src="js/app.js" defer></script>
    <script src="js/component/header.js" defer></script>
    <script src="js/component/footer.js" defer></script>
    <script src="js/component/logo.js" defer></script>
    <script src="js/component/blogintro.js" defer></script>
    <script src="js/component/blogcontent.js" defer></script>
    <script src="js/component/blogrecent.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>
<body>

    <section class="bg-js-controlled">
        <header-component></header-component>
    </section>
    
    <section class="bg-js-controlled">
        <section class="intro">
            <blogintro-component>
                <span slot ="title">First Android Game - Part 4</span>
                <span slot="date">June 19, 2023</span>
                <!-- <button slot="vlogbutton" onclick="OnLinkClick('https://www.youtube.com/watch?v=2eVfeaquPtg')">Watch vlog instead</span> -->
               
            </blogintro-component>
        </section>
    
    
            <section class="diarypost">
                <blogcontent-component>
                    <span slot ="action1text">This is part 4 of making my first Android Game. If you missed part4, you can find it <a href="blogfirstandroidgame3.html">here</a></span>
                    <span slot ="action2text">I am following the tutorial to create photon <a href="https://www.youtube.com/watch?v=93SkbMpWCGo">here</a>.Time to add in Photon so my game be a multiplayer game. First I created an app on Photon dashboard. I selected PUN as the photon type</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon1.PNG" slot="action2image">
                    <span slot ="action3text">I then imported the Photon unity asset called PUN 2 free<a href="https://assetstore.unity.com/packages/tools/network/pun-2-free-119922">here</a></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon2.PNG" slot="action3image">
                    <span slot ="action4text">I created a new scene and named it Loading with a Loading text. I created an empty gameobject called "ConnectToServer" and attached a script called "ConnectToServer" that calls PhotonNetwork.ConnectUsingSettings()</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon3.PNG" slot="action4image">
                    <span slot ="action5text">I added a Lobby scene and created two inputfields and buttons for create and join. Added to callback functions into ConnectToServer script. They are OnConnectToMaster() and OnJoinedLobby(). This allowed the loading scene to load into lobby</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon5.PNG" slot="action5image">
                    <span slot ="action6text">Now that was a basic way to connect to the lobby. I wanted to allow users to enter their names. So I started following this tutorial <a href="https://www.youtube.com/watch?v=y69wBS13wwA&t=161s">here</a>. In my start menu I removed the one and two player button. I replaced them with an input field for the user to enter their name and a button to connect to the lobby. The PhotonNetwork.ConnectUsingSettings(); gets called if the user has entered a name and pressed the connect button. The button text will display "Connecting..." while trying to enter the lobby.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon14.PNG" slot="action6image">

                    
                    <span slot ="action9text">A component called PhotonView is added to the player prefab. This component is needed to be connected on to the server. Any prefab to be spawned on the network must be in the Resources folder. So I moved the Player prefab into the Resources folder</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon6.PNG" slot="action9image">
                    <span slot ="action10text">In the player script. I check if the PhotonView isMine. This will let the user control their own players</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon7.PNG" slot="action10image">
                    <span slot ="action11text">To sync the position of the players across the network, a component called "PhotonTransformViewClassic" is added to the player and the "SynchornizePosition" field is enabled</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon8.PNG" slot="action11image">
                    <span slot ="action12text">Now I want to spawn the players in the game. I create a SpawnPlayer script and using PhotonNetwork.Instantiate</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon9.PNG" slot="action12image">
                    <span slot ="action13text">The players movement are synched across the game. However, both are treated as Player1 and the enemies/bullets are not on the network yet. You can't see the other player's bullets and if the other player gets destroyed you won't notice. However, if the other player's network drops, it will disappear from your game</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon10.gif" slot="action13image">
                    <span slot ="action14text">Another problem was that both players spawn in the same location. To resolve this, I do a check if it is IsMasterClient, spawn player on the left spawn point. Otherwise, spawn in right spawn point. I will only have max two players eventually so this way works</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon13.PNG" slot="action14image">
                    <span slot ="action15text">I wanted to see what happens when I have internet turned off. It appears the OnJoinedLobby() callback function cannot be called but OnConnectedToMaster() will still be called-this may be because according to this <a href="https://doc.photonengine.com/pun/current/gameplay/offlinemode">documentation</a> PhotonNetWork.IsMasterClient is always true when OfflineMode is set to true. With internet turned off, if I press 1 player button, lobby will load and game functions in editor. However, this means OnJoinedLobby() won't get called. I will revisit this again another time. Going to try to get the other items working online and shared across two players such as background/enemies/scoreboard</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon11.PNG" slot="action15image">
                    <span slot ="action16text">It was time to sync up the enemies. I moved all the enemies and explosions prefab to the Resources folder. On all of them I added the PhotonView component so they can be read across the network. Also added the PhotonTransformViewClassic and enabled synchronize Position. When I made the build and tested, the client will throw an error when trying to get the explosions: <p style="color:red">ArgumentOutOfRangeException: Index was out of range. Must be non-negative and less than the size of the collection.</p> The explosions pool objects were 0 for the client.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon12.PNG" slot="action16image">

                </blogcontent-component>
            </section>

            <section class="blogrecent">
                <blogrecent-component>
                    <span slot="recentblogs">Recent blogs</span>
                    <span slot="seeallblogs"><a href="index.html#blog">See all blogs</a></span>
                </blogrecent-component>

            </section>
    </section>
    

 


    <section class="footer-section bg-js-controlled" id="contact">
        <footer-component></footer-component>
    </section>


    
    
</body>
</html>

