<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Android Game - Eldon Lin Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/blogproject.css">
    <script src="js/app.js" defer></script>
    <script src="js/component/header.js" defer></script>
    <script src="js/component/footer.js" defer></script>
    <script src="js/component/logo.js" defer></script>
    <script src="js/component/blogintro.js" defer></script>
    <script src="js/component/blogcontent.js" defer></script>
    <script src="js/component/blogrecent.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>
<body>

    <section class="bg-js-controlled">
        <header-component></header-component>
    </section>
    
    <section class="bg-js-controlled">
        <section class="intro">
            <blogintro-component>
                <span slot ="title">First Android Game - Part 20 - Save data - MySQL</span>
                <span slot="date">Oct 08, 2023</span>
                <button slot="vlogbutton" onclick="OnLinkClick('https://youtu.be/fHY3aUUX3r4')">Watch on youtube</span>   
            </blogintro-component>
        </section>
    
    
            <section class="diarypost">
                <blogcontent-component>
                    <span slot ="action1text">This is part 20 of making my first Android Game. If you missed part19, you can find it <a href="blogfirstandroidgame19.html">here</a>. There are weapons that the user can buy. If the user starts the game over and come back into the game, it would be great if what they bought are carried over. It can be frustrating for the user if all the weapons are gone. We will be exploring different ways to save data. The first one we will explore is MySQL. I will be following this <a href="https://www.youtube.com/watch?v=SKbY-0zt2VE&list=PL5KbKbJ6Gf99mcmE1ptsn0oXO1_vnKDlS&index=3">Tutorial playlist by BoardToBits</a></span>
                    <span slot ="action2text">To create a database I will need to setup a local server. Therefore, I will download MAMP from this <a href="https://www.mamp.info/en/windows/">site</a>. When I open MAMP, I will first go to MAMP > Preferences > Server and change the Document Root. This is where all the PHP files will be stored</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql1.PNG" slot="action2image">
                    <span slot ="action3text">I'll need setup the database. Select the Open WebStartPage. A http://localhost/MAMP/ will open. localhost refers to the root that we set in Web Server Document Root. MAMP is the splash page that MAMP made. We will select the hyper link that says phpMyAdmin</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql2.PNG" slot="action3image">
                    <span slot ="action4text">At the home page select user accounts. You will see a "root" user account. This is the default. If you decide to make your application for public to use, you should create your own user account with a new user name and password</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql3.PNG" slot="action4image">
                    <span slot ="action5text">Now we need to create a database to connect. Select database, I will name my database unity-sql-learning. Select create</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql4.PNG" slot="action5image">
                    <span slot ="action6text">Create a table for the database. Name it player and set number of columns to 5</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql5.PNG" slot="action6image">
                    <span slot ="action7text">There are 5 rows where we need to populate information about them. Each row we will need to provide information about them. Those are the name, type, length/values, default, coaliation, Null, index, A_I, and comments.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql6.PNG" slot="action7image">
                    <span slot ="action8text">The first information is a unique identifier called id. We want the id to differentiate the players. Type is int, give a length 10. We won't worry about default, coliation and attributes. NULL is false. The index will be PRIMARY. A_I is autoincrement, set that to true. Next one is username, type is VARCHAR which is a combination of letters and numbers. Max length is 16 character. Skip default(because we want someone to populate this field), coaliation, attribute, null. Index needs to be unique. Skip A_I. Next is password, but we won't store password as plain text for security reasons. We will use hash and salt. Set both to VARCHAR because a good password have different characters. Length is 100 and 50 respectively. Skip the rest. Lastly is the score - this is the game data we want to store. Type is INT. Length is 10. Default as As defined and set to 0 because by default the score is 0. Skip the rest. Make sure you save. </span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql7.PNG" slot="action8image">
                    <span slot ="action9text">I will be using sublime text to code my php. Sublime can be downloaded <a href="https://www.sublimetext.com/">here</a>. In Unity, we will create 4 scenes: Main Menu, Login, Register, Game. Main Menu will have 3 buttons: RegisterMenu, Login, Play Game  and a text that tells us if the user is logged in. RegisterMenu has a button that says register and two input fields that lets user enter their username and password. Login Scene has the same two inputfields as Register but the button will say Log in. Game Scene will have a button the increments the score and a button that exits the game and go back to Main Menu scene. In the Main Menu Scene and RegisterMenu scene, attach a script called MainMenu.cs and Registeration.cs to the canvas respectively. The MainMenu.cs will have reference to all 3 buttons and the text. Create a function for each button so that the user presses Register, Login and PlayGame button it will load the RegisterMenu scene, Login Scene and Game scene. I will wrap this code in the namespace MySQLLearning so that it does not conflict with my tomato vs potato game. This is because these scripts are for testing.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql8.PNG" slot="action9image">
                    <span slot ="action10text">Attach a reference the OnClick on each button. For example, the Login has a reference to the canvas and the function is <code>GoToLogin()</code></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql9.PNG" slot="action10image">
                    <span slot ="action11text">In Registration.cs, I have a reference to the inputfields and the register button. The register button is not interactable at the start. It is also not interactable if the number of characters in username and password are less then 8 characters</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql10.PNG" slot="action11image">
                    <span slot ="action12text">On the inputfields for username and password in RegisterMenu scene, attach a reference to <code>VerifyInput</code> to On Value Changed</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql11.PNG" slot="action12image">
                    <span slot ="action13text">Create a public function called <code>CallRegister()</code> which will call a coroutine called <code>RegisterRoutine()</code>. On the Register button, have the OnClick reference to <code>CallRegister()</code></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql12.PNG" slot="action13image">
                    <span slot ="action14text">The <code>RegisterRoutine()</code> will make a post to the url specified. In this case it is <code>http://localhost/register.php</code> which is where our <code>register.php</code> script will be saved. In the form it will pass in the username and password that the user has entered in the inputfield. This will be passed into a <code>WWWForm</code></span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql13.PNG" slot="action14image">
                    <span slot ="action15text">The routine will wait for the webrequest to finish making its request. If it fails due to Connection error, processing error or protical error. It will try again until its reaches the <code>const int MAX_REQUEST_ATTEMPT_COUNT</code> which I set to 2. Then it will print out the downloadhandler information</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql14.PNG" slot="action15image">
                    <span slot ="action16text">If the request succeeds, I will check if the downloadhandler text does not contain a "0". This 0 will be from <code>echo</code> from the <code>register.php</code>. a non 0 will be an error code we add in a bit. If there is a 0, then everything passed and we load into the Login scene.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql15.PNG" slot="action16image">
                    <span slot ="action17text">Now we will go into sublime text to create register.php. I will be saving this php script in the folder specified in the document root. In any php scripts, we need to encapsulate them in <code><?php ?></code>. We will make a connection to our database. We will store that in a variable called <code>$con</code>. To connect to the database will make a function call <code>mysqli_connect()</code>. We will pass into the function the location of the database, which in this case is <code>localhost</code>. Then the user name which in this case is <code>root</code>, and also the password which is <code>root</code>. The password won't be seen in the browser and only stored on the backend so it is ok to hardcode the password here. Lastly we put in the database which in this case is <code>unity-sql-learning</code>. Now we want to check if the connection happened by doing an if statement to see if there were any errors <code>mysqli_connect_errno()</code>. If there is, we will <code>echo 0</code>. Echo is like debug log, it's the text the prints into the downloadhandler text. We will <code>echo 1</code> if there is an error. We will <code>exit()</code> if there is an error. If it is successful, we will create a variable called <code>username</code> and <code>password</code>. Remember we get the username and password from the <code>WWWForm</code>. Using <code>$_POST</code> where <code>$_</code> means it is a constant thing and we check for <code>POST</code> to see if there is the variable name and password from the form. Next we will double check if the name already exist, if the name exist we will not allow the user to add the name by using a query. First we create a variable called <code>namecheckquery</code>. We set the variable to <code>"SELECT username FROM players WHERE username='" . $username . "';";</code> player is the table and username is the column. We concatenate a string by using periods <code>.</code> which is the php version of concatenating. Next, we create a variable <code>namecheck</code> which is set to a function call <code>mysqli_query()</code>. This function takes in our connection variable <code>con</code> our query variable <code>namecheckquery</code>. If this query did not work we say <code>or die("2: Name check query failed")</code> which will exit the code AND display information "2". Now we see if this name exists by checking if any rows were returned by doing an if statement and checking <code>mysqli_num_rows($namecheck) > 0</code>. If this is true then the name exists and we echo an error code. Otherwise, everything passed then we can add the user to the table.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql16.PNG" slot="action17image">
                    <span slot="action18text">We need to make sure to salt and hash the password because we can't store passwords as plain text. Hashing means they can't immediately some information and get some password. Salting means we don't let hackers use lookup tables to break through encrypted passwords. So first create a <code>salt</code> variable. Assign it to <code>\$5\$rounds=5000\$</code>. Note the \ tells us write the actual symbol, in this case the $ symbol. The $ symbol is not any thing special. We are using a SHA256 to encrypt passwords (indicated by the 5), it will use 5000 shifts and come up with a nest of code to encrypt the password. We then concatenate an additional line, can be anything that we want. We want a 16 character salt, and in this case we use the username as part of the salt. We pass in the username and concatenate on last <code>\$</code>. The hash variable will be assigned to <code>crypt($password, $salt)</code> Then we will use the query that inserts the information into the database. <code>"INSERT INTO players (username, hash, salt) VALUES ('" . $username . "', '" . $hash . "', '" . $salt . "');";</code> we will send this query by doing <code>mysqli_query($con, $insertuserquery) or die("4: Insert player query failed");</code>. Lastly we will echo 0! Remember 0 is how we check downloadhandler text in our Registeration.cs</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql17.PNG" slot="action18image">
                    <span slot="action19text">Now when a user successfully registers, the player table will have a row. Notice that the ID is 3, meaning this is the the 3rd person that registered because autoicrement the id. The salt and hash are encrypted. Score by default is 0</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/mysql18.PNG" slot="action19image">
                                 
                </blogcontent-component>
            </section>

            <section class="blogrecent">
                <blogrecent-component>
                    <span slot="recentblogs">Recent blogs</span>
                    <span slot="seeallblogs"><a href="index.html#blog">See all blogs</a></span>
                </blogrecent-component>

            </section>
    </section>
    

 


    <section class="footer-section bg-js-controlled" id="contact">
        <footer-component></footer-component>
    </section>


    
    
</body>
</html>

