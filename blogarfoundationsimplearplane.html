<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Eldon Lin Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/blogproject.css">
    <script src="js/app.js" defer></script>
    <script src="js/component/header.js" defer></script>
    <script src="js/component/footer.js" defer></script>
    <script src="js/component/logo.js" defer></script>
    <script src="js/component/blogintro.js" defer></script>
    <script src="js/component/blogcontent.js" defer></script>
    <script src="js/component/blogrecent.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>
<body>

    <section class="bg-js-controlled">
        <header-component></header-component>
    </section>
    
    <section class="bg-js-controlled">
        <section class="intro">
            <blogintro-component>
                <span slot ="title">ARCore</span>
                <span slot="date">Sep 16, 2023</span>
                <button slot="vlogbutton" onclick="OnLinkClick('https://www.youtube.com/playlist?list=PLJJXiMHWLglpYhw7GosceJfx6WHpyw9bt')">Watch Playlist</span>               
            </blogintro-component>
        </section>
    
    
            <section class="diarypost">
                <blogcontent-component>
                    <span slot ="action1text">Using Unity 2021.3.16f1, AR foundation 4.2. The main goal is to learn ARCore. First is to have plane detection and when the user tap on the plane, a cube will appear. I will be following the <a href="https://github.com/Unity-Technologies/arfoundation-samples/tree/4.2">ar foundation sample</a> from github</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arcore.jpg" slot="action1image">
                    <span slot ="action2text">I created an empty scene called SampleAR. I deleted the main camera. I right click the hierarchy > XR > AR Session. As described in this <a href="https://developers.google.com/ar/develop/unity-arf/session-config">documentation</a> "All AR processes, such as motion tracking, environmental understanding, and lighting estimation, happen inside an ARCore session. ARSession is the main entry point to the ARCore API. It manages the AR system state and handles the session lifecycle, allowing the app to create, configure, start, or stop a session. Most importantly, it enables the app to receive frames that allow access to the camera image and device pose" in short an AR Session " Controls the lifecycle of an AR experience"</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arsession.PNG" slot="action2image">
                    <span slot ="action3text">I right click the hierarchy > XR > AR Session Origin. As described in this <a href="https://developers.google.com/ar/develop/unity-arf/getting-started-ar-foundation">documentation</a>, an AR session origin "Transforms AR coordinates into Unity world coordinates.". There is an AR camera in AR Session origin - which is why we did not need the default camera</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arsessionorigin.PNG" slot="action3image">
                    <span slot ="action4text">I created 3 buttons where in the onclick referenecs AR Session: Reset, Pause, Resume. Where they call ARSession.Reset,ARSession.enabled(boolean is false) and ARSession.enabled(boolean is true) respectively. Reset clears all detected trackables(Planes and points) and starts a new session. Pause will pause the device tracking and trackable detection - AR Session will not consume CPU resources. Resume a paused ARSession will let the device attempted to relocalize and previously detected objects may shift around as tracking is restablished</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arsessionbuttons.PNG" slot="action4image">
                    <span slot ="action5text">On the AR Session Origin, I added an AR Plane Manager component. As explained <a href="https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@4.2/manual/plane-manager.html">here</a>, when a plane is detected, the AR Plane Manager will instantiate a plane prefab. The plane detection can be nothing, everything, horizontal or vertical. I have selected everything</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arplanemanager.PNG" slot="action5image">
                    <span slot ="action6text">The plane prefab is created by right clicking in the hierarchy > XR > AR Default plane. This AR Default plane is made into a prefab and then dragged into the Plane Prefab field of the AR Plane Manager component.</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/ardefaultplane.PNG" slot="action6image">
                    <span slot ="action7text">On the AR Session Origin, I added the AR Point Cloud Manager component. This Uses the XRDepthSubsystem to recognize and track depth data in the physical environment.</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arpointcloudmanager.PNG" slot="action7image">
                    <span slot ="action8text">The point cloud prefab is created by right clicking in the hierarchy > XR > AR Default point cloud. This is made into a prefab and then dragged into the point cloud prefab field of the AR Point Cloud Manager Component</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/ardefaultpointcloud.PNG" slot="action8image">
                    <span slot ="action9text">I added the ARRaycastManager component on to the AR Session Origin. Used to raycast against trackables</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/arraycastmanager.PNG" slot="action9image">
                    <span slot ="action10text">I created a PlaceOnPlane.cs to be attached to the ARSessionOrigin gameobject. I copied the code from the github example over. Let's analyze what the code this. First is the namespace. I need <code>using UnityEngine.XR.ARFoundation</code> and <code>using UnityEngine.XR.ARSubsystems;</code> So I can reference AR code</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/samplearplane1.PNG" slot="action10image">
                    <span slot ="action11text">In the Update(), we check if user has touched the screen. If no then we don't need to do anything and return so Update() loop does not continue in this frame. If yes, assign the touchposition and get that touch position back.</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/sampleplane2.PNG" slot="action11image">
                    <span slot ="action12text">If there was a touch position, we check what the raycast has hit by calling the Raycast method from ARRaycastManager. The Raycast takes in a Vector2 position,list of ARRaycast hit results, and a trackable type which in this case we choose PlaneWithPolygon </span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/sampleplane3.PNG" slot="action12image">
                    <span slot ="action13text">We will set the position and orientation to be the 0 index of the list of ARRaycast hit result. This works because ARRaycast  hits are sorted by distance so the object we spawn will be placed on the closest distance. If we have not spawned the gameobject yet then spawn it on the closest hit result. Otherwise, change the position of the gameobject to the newly tapped position</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/sampleplane4.PNG" slot="action13image">
                    <span slot ="action14text">Below is a screenshot of what the plane detection looks like</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/sampleplane5.PNG" slot="action14image">
                    <span slot ="action15text">Next I want to do what the TogglePlaneDetection Sample scene does from the AR Foundation example. In this one, the user presses a button to enable/disable the planes. Analyzing the PlaneDetectionController.cs, I learned two things: (1) I can loop through ARPlaneManager and enable or disable all trackables such as planes by doing 
                    <code>foreach (var plane in m_ARPlaneManager.trackables) plane.gameObject.SetActive(value);</code>where m_ARPlaneManaager is a class member variable of type <code>ARPlaneManager</code> (2) and second is I can check or set if the ARPlaneManager is enabled by calling the enabled property like this <code>m_ARPlaneManager.enabled = !m_ARPlaneManager.enabled;</code></span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/planetoggle1.PNG" slot="action15image">
                    <span slot ="action16text">Those code are created in a script called PlaneDetectionController.cs and attached to the AR Session Origin gameobject becuase it contains the ARPlaneManager. I kept the AR Default Point Cloud which has a partical system. You can see in the screenshot below that the planes has been detected but the particle system is still there. Check the youtube playlist to see the result!</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/planetoggle2.PNG" slot="action16image">
                    <span slot ="action17text">The AR Default plane has a Mesh Renderer component attached to it, so I can change the material. To make sure that material really does change the mesh,I changed it to a frog material that I have in the project</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/planetoggle3.jpg" slot="action17image">
                    <span slot ="action18text">Next is to do facetracking. Start of simple and have a Red nose! I created a new scene and added AR Session and AR Session Origin to the scene. Since By default the AR Face Manager instantiates the prefab at the origin point which is defined as the Center of a user's head (located inside the skull behind the nose), all I need to do is attach the AR Face Manager component to AR Session Origin. The face prefab I attached is a Red sphere - which I had to lower the scale to 0.05 on all axis</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking.PNG" slot="action18image">
                    <span slot ="action19text">I made a bulid but the camera was facing the wrong way and I couldn't change the camera orientation. Turns out on AR Camera Manager component that is attached to the AR Camera gameobject, I had to change facing direction to User.</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking2.PNG" slot="action19image">
                    <span slot ="action20text">Here's the result!</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking1.gif" slot="action20image">
                    <span slot ="action21text">Next step is to press buttonss and change the face prefab on run time. I created a script called <code>ARFacePrefabController.cs</code> and attached it to the AR Session Origin. The logic is when a button is clicked, it will loop through all the faces being tracked and change the prefab</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking3.PNG" slot="action21image">
                    <span slot ="action22text">I also attached ARFace to the all the face prefabs that will be used</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking4.PNG" slot="action22image">
                    <span slot ="action23text">I added an OnClick for all the buttons. Dragged in ARSessionOrigin, linked the <code>FacePrefabOnClickChange()</code> and dragged in the prefab that will be spawned</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking5.PNG" slot="action23image">
                    <span slot ="action24text">However, when I click the button, the prefab does change, I had to point the camera away from the face and then back to the face for the prefab to spawn. This is NOT what I want! I want the prefab to change immediately when the button is clicked</span>
                    <img class="diarypostimage" src="images_videos/blog/ARFoundationSamples/facetracking6.gif" slot="action24image">
                    
                    
                    
                                       
                </blogcontent-component>
            </section>

            <section class="blogrecent">
                <blogrecent-component>
                    <span slot="recentblogs">Recent blogs</span>
                    <span slot="seeallblogs"><a href="index.html#blog">See all blogs</a></span>
                </blogrecent-component>

            </section>
    </section>
    

 


    <section class="footer-section bg-js-controlled" id="contact">
        <footer-component></footer-component>
    </section>


    
    
</body>
</html>

