<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Android Game - Eldon Lin Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/blogproject.css">
    <script src="js/app.js" defer></script>
    <script src="js/component/header.js" defer></script>
    <script src="js/component/footer.js" defer></script>
    <script src="js/component/logo.js" defer></script>
    <script src="js/component/blogintro.js" defer></script>
    <script src="js/component/blogcontent.js" defer></script>
    <script src="js/component/blogrecent.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>
<body>

    <section class="bg-js-controlled">
        <header-component></header-component>
    </section>
    
    <section class="bg-js-controlled">
        <section class="intro">
            <blogintro-component>
                <span slot ="title">First Android Game - Part 8 - Collecting coins</span>
                <span slot="date">July 21, 2023</span>
                <button slot="vlogbutton" onclick="OnLinkClick('https://www.youtube.com/playlist?list=PLJJXiMHWLgloHkx0DWFJtN_Min3OEU-T4')">Watch youtube playlist</span>               
            </blogintro-component>
        </section>
    
    
            <section class="diarypost">
                <blogcontent-component>
                    <span slot ="action1text">This is part 8 of making my first Android Game. If you missed part7, you can find it <a href="blogfirstandroidgame7.html">here</a></span>
                    <span slot ="action2text">To collect coins I am going to spawn them with the same logic that I spawned the enemeis. In CoinPoolInstance.cs I am using the same spawn location gameobject I used for spawning the enemies. There aren't any coin types anymore and the coin prefabs are on the Instance.</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon149.PNG" slot="action2image">
                    <span slot ="action3text">On CoinPoolInstance.cs, I have the master calling the spawning coins coroutines</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon150.PNG" slot="action3image">
                    <span slot ="action4text">The coroutines chooses a random location to spawn the coins, just like the enemies</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon151.PNG" slot="action4image">
                    <span slot ="action5text">On Coin.cs I am getting the PhotonView component. All the Coin prefab have a PhotonView component and a Photon Transform Classics View component with Synchronize Position</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon152.PNG" slot="action5image">
                    <span slot ="action6text">The OnTriggerEnter2D in Coin.cs checks if view.IsMine, if it is call a RPC function named CoinCollected and Calls PhotonNetwork.Destroy</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon153.PNG" slot="action6image">
                    <span slot ="action7text">The CoinCollected RPC function spawns the coin text</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon154.PNG" slot="action7image">
                    <span slot ="action8text">The Coroutine EnabledObject() in Coin.cs checks how long the coin stays before getting destroyed</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon155.PNG" slot="action8image">
                    <span slot ="action9text">In CoinTExt.cs, it is reduced to the same logic as Explosion.cs where it gets Destroyed after timeBeforeDestroy seconds. In Update(), the text will be translated upwards. I am not worried about the text location getting synced because it will be roughly in the same location as where the coin is</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon156.PNG" slot="action9image">
                    <span slot ="action10text">After testing, some bugs were noticed: (1) sometimes when two coins are close to each other and are collected at the same time, only one coin amount is added, this occurs on develop branch as well so this bug existed before the changes. </span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon157.PNG" slot="action10image">
                    <span slot ="action11text">(2)On the client side, sometimes the number of coins does not get added even though it is collided with the player. I added Debug.Log() in Player.cs where there is a check if Player collides with the coin, and the Debug.Log does not always get printed. From the results below, you can see that even though the coins collides with the player, it doesn't always print out the Debug.Log, however, the coins always disappears and the cointext is always spawned. This means on the Master, the PunRPC function that spawns the text is being called, but the collision is not being detected on the client side</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon158.gif" slot="action11image">
                    <span slot ="action12text">My hunch with the issue of the number of coins not getting added was due to PhotonNetwork.Destroy() getting called on the coins on master side before the client player collides with the coin. I thought of this because this issue appears to occur only if the coin collides with the client player head on in the front. This never occurs if the coin collides with the player on the side. Also, the RPC function which gets called on master only that spawns the coin text is always triggered but the coin does not always get added. So I did a test on EnemyBase.cs, if the enemy collides with the player, destroy the enemy. I also disabled the bullet so I can have the player collide with the enemy. In Player.cs, if the player collides with the enemy, print out enemy hit to the console. My hunch was correct as shown in the result. Now the question is how would I resolve this? This issue is occuring for both enemy and coin. Enemy was not noticeable because the bullet destroyed the enemy before hitting the player in the front </span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon159.gif" slot="action12image">
                    <span slot ="action13text">I thought instead of doing photonnetwork.Destroy() in coin.cs, I can do it on Player.cs when player collides with the coin</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon160.PNG" slot="action13image">
                    <span slot ="action14text">However, that did not work and I just got errors if the client player tries to destroy the coins using photon.network</span>
                    <img class="diarypostimage" src="images_videos/blog/FirstAndroidGame/photon161.PNG" slot="action14image">
                                       
                </blogcontent-component>
            </section>

            <section class="blogrecent">
                <blogrecent-component>
                    <span slot="recentblogs">Recent blogs</span>
                    <span slot="seeallblogs"><a href="index.html#blog">See all blogs</a></span>
                </blogrecent-component>

            </section>
    </section>
    

 


    <section class="footer-section bg-js-controlled" id="contact">
        <footer-component></footer-component>
    </section>


    
    
</body>
</html>

